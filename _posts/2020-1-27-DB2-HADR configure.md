DB2 HADR configure



## 设置归档

db2 update db cfg for HADB using logretain on 

备份

db2 backup database HADB TO /mnt/hgfs/share 

## 在备库还原

db2start 

db2 RESTORE DATABASE HADB FROM “/mnt/hgfs/share”

## 重新配置客户端路由

语法：
 UPDATE ALTERNATE SERVER FOR DATABASE database-alias 
 USING HOSTNAME hostname PORT port-numbe 



FOR PRIMARY：

db2 UPDATE ALTERANATE SERVER FOR DATABASE HADB  USING HOSTNAME 192.168.189.129 PORT 50000 



FOR STANDBY：



db2 UPDATE ALTERANATE SERVER FOR DATABASE HADB  USING HOSTNAME 192.168.189.128 PORT 50000 

## 配置HADR服务

VI编辑/etc/services 文件，添加如：



/etc/services 

 DB2_HADR_1 55001/tcp 

 DB2_HADR_2 55002/tcp 

FOR PRMARY:
01 # db2 UPDATE DB CFG FOR HADB USING HADR_LOCAL_HOST 192.168.189.128 

02 # db2 UPDATE DB CFG FOR HADB USING HADR_LOCAL_SVC DB2_HADR_1 

03 # db2 UPDATE DB CFG FOR HADB USING HADR_REMOTE_HOST 192.168.189.129 

04 # db2 UPDATE DB CFG FOR HADB USING HADR_REMOTE_SVC DB2_HADR_2 

05 # db2 UPDATE DB CFG FOR HADB USING HADR_REMOTE_INST db2hadr 

06 # db2 UPDATE DB CFG FOR HADB USING HADR_SYNCMODE NEARSYNC 

07 # db2 UPDATE DB CFG FOR HADB USING HADR_TIMEOUT 120 

08 # db2 CONNECT TO HADB 

09 # db2 QUIESCE DATABASE IMMEDIATE FORCE CONNECTIONS 

10 # db2 UNQUIESCE DATABASE 

FOR STANDBY:
01 # db2 UPDATE DB CFG FOR HADB USING HADR_LOCAL_HOST 192.168.189.129 

02 # db2 UPDATE DB CFG FOR HADB USING HADR_LOCAL_SVC DB2_HADR_2 

03 # db2 UPDATE DB CFG FOR HADB USING HADR_REMOTE_HOST 192.168.189.128 

04 # db2 UPDATE DB CFG FOR HADB USING HADR_REMOTE_SVC DB2_HADR_1 

05 # db2 UPDATE DB CFG FOR HADB USING HADR_REMOTE_INST db2hadr 

06 # db2 UPDATE DB CFG FOR HADB USING HADR_SYNCMODE NEARSYNC 

07 # db2 UPDATE DB CFG FOR HADB USING HADR_TIMEOUT 120 

## 启动HADR

START HADR ON DATABASE dbname AS [Primary | Standby] 
先启动备库

db2 deactivate database hadb 

db2 start hadr on database hadb as standby 

后启动主库

db2 deactivate database hadb 

db2 start hadr on database hadb as primary